<!--
Inlined style tag because not allowed to link a separate stylesheet. 
https://forum.figma.com/ask-the-community-7/linking-css-to-ui-html-31363
-->
<style>
  * {
    margin: 0;
  }

  body {
    font-family: Inter, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--figma-color-bg);
    color: var(--figma-color-text);
    padding: 1rem;
  }

  h1 {
    text-align: center;
    text-wrap: balance;
    font-size: 1.5rem;
    margin-block-end: 1rem;
  }

  strong {
    font-weight: 900;
    color: var(--figma-color-text-success);
  }

  textarea,
  button {
    font-family: inherit;
    font-size: inherit;
    background-color: inherit;
    color: inherit;
    border: inherit;
  }

  textarea {
    background-color: var(--figma-color-bg-secondary);
    border: 2px solid transparent;
    border-radius: 8px;
    padding-inline: 1ch;
    padding-block: 0.5em;
    margin-block: 1rem;
    min-width: 100%;
    max-width: 100%;
    min-height: 9em;
    outline: none;

    font-size: 0.75rem;


    &:hover {
      border-color: var(--figma-color-border);
    }

    &:focus {
      border-color: var(--figma-color-border-selected);
    }
  }

  #counts {
    display: grid;
    gap: 0;
    margin-block-end: 1rem;

    & p {
      margin: 0;
    }
  }

  ul {
    font-size: 0.75em;
    padding-left: 4ch;
  }

  li.case-active {
    color: var(--figma-color-text-selected);
  }

  .button-section {
    display: grid;
    grid-template-columns: 1fr 1fr;
    font-size: 1rem;
    gap: 0.5rem;
    margin-block-start: 1rem;
  }

  button {
    padding: 0.5em 1ch;
    cursor: pointer;
    border-radius: 8px;

    background-color: var(--figma-color-bg-brand);
    color: white;

    &:hover,
    &:focus {
      background-color: var(--figma-color-bg-brand-hover);
    }

    &:disabled {
      cursor: not-allowed;
      background-color: var(--figma-color-bg-disabled);
      color: var(--figma-color-text-secondary);
    }
  }

  button#cancel {
    background-color: var(--figma-color-bg-secondary);
    color: var(--figma-color-text);

    &:hover,
    &:focus {
      background-color: var(--figma-color-bg-tertiary);
    }
  }
</style>

<h1>Bulk Rename Layers by Name List</h1>


<p>
  <label for="namelist">Enter a list of new names for your layers, separated by line breaks:</label>
</p>
<textarea name="namelist" id="namelist" placeholder="Alice\nBob\nCharlie"></textarea>

<section id="counts">
  <p>You have provided <strong id="name-count">0</strong> names right now.</p>
  <p>You have selected <strong id="selection-count">0</strong> layers right now.</p>
</section>

<ul>
  <li id="case-equal">Ideally, (# names) = (# selected layers). Each selected layer will get one name.</li>
  <li id="case-more-names">If (# names) &gt; (# selected layers), then some names at the end of the list will go unused.
  </li>
  <li id="case-more-layers">If (# names) &lt; (# selected layers), then some layers lower in the scene tree will not be
    renamed.</li>
</ul>

<section class="button-section">
  <button id="execute">Rename Layers</button>
  <button id="cancel">Cancel</button>
</section>

<script>
  const selectionCountLabel = document.getElementById("selection-count")
  const nameCountLabel = document.getElementById("name-count")
  const namelistField = document.getElementById("namelist")
  const executeButton = document.getElementById("execute")
  const cancelButton = document.getElementById("cancel")

  const caseEqual = document.getElementById("case-equal")
  const caseMoreNames = document.getElementById("case-more-names")
  const caseMoreLayers = document.getElementById("case-more-layers")

  let currentSelectionCount = 0
  let currentNameCount = 0

  function updateUiInGeneral() {
    executeButton.disabled = currentSelectionCount === 0 || currentNameCount === 0

    caseEqual.classList.remove("case-active")
    caseMoreNames.classList.remove("case-active")
    caseMoreLayers.classList.remove("case-active")

    if (currentSelectionCount === 0 || currentNameCount === 0) {
      return
    }

    if (currentSelectionCount === currentNameCount) {
      caseEqual.classList.add("case-active")
    }
    if (currentNameCount > currentSelectionCount) {
      caseMoreNames.classList.add("case-active")
    }
    if (currentSelectionCount > currentNameCount) {
      caseMoreLayers.classList.add("case-active")
    }
  }

  function updateSelectionCount(newCount) {
    if (newCount === currentSelectionCount) {
      return
    }

    currentSelectionCount = newCount
    selectionCountLabel.textContent = currentSelectionCount.toString()
    updateUiInGeneral()
  }

  function updateNameCount(newCount) {
    if (newCount === currentNameCount) {
      return
    }

    currentNameCount = newCount
    nameCountLabel.textContent = currentNameCount.toString()
    updateUiInGeneral()
  }

  function getNames() {
    const userInput = namelistField.value
    return userInput.split("\n").filter(name => name.trim() != "")
  }

  namelistField.addEventListener("keyup", (event) => {
    updateNameCount(getNames().length)
  })

  executeButton.onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'execute-bulk-rename', names: getNames() } }, '*')
  }

  cancelButton.onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*')
  }

  onmessage = (event) => {
    const message = event.data.pluginMessage
    if (message.type === "selection-count-update") {
      updateSelectionCount(message.count)
    }
  }

  function init() {
    namelistField.placeholder = namelistField.placeholder.replace(/\\n/g, "\n")
  }

  init()
</script>